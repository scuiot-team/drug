我现在大概能理清药物逻辑了：

每个药物有下面几个参数：

- id: string,        // 唯一标识
- drugName: string,  // 药品名称
- dosage: string,    // 给药剂量
- form: string,      // 药物剂型
- dose: string,      // 给药方式
- interval: string,  // 给药间隔
- time: string,      // 初次给药
- startDate: string, // 开始日期
- stopDate: string,  // 结束日期

drug.id用「创建该药物时的timestamp」代替，理论上是不会重复的。

创建药物时填入这几个参数，程序会自动计算出用药方案，并推算出之后**开始日期~结束日期**之间的每一次给药。（但是将来的每一次用药都是根据所有用药方案实时推算出来，不存入任何全局变量中）

小程序打开时会计算出「现在之前所有漏掉的服药」。计算方式是从「每种药的用药记录」中“最新的那项”开始，根据该药物的给药间隔，算出到现在为止漏掉的服药。然后就每次漏掉的服药询问——是否已经服药or是否跳过这次，并将这次服药加入「用药记录」中。**注意不管是否跳过服药都会加入用药记录，跳过则record.skip=true**。用药记录永远记录的是「已经结束的」服药计划，是个数组，其中的每个元素有下面这些参数：

-  public id: string,        // 唯一标识
-  public drugName: string,  // 药品名称
-  public dosage: string,    // 给药剂量
-  public form: string,      // 药物剂型
-  public dose: string,      // 给药方式
-  public date: string,      // 服药日期
-  public time: string,      // 服药时间
-  public skip: Boolean,     // 是否跳过 (默认为false)

其中用药记录的id就是该药物的id，用于通过用药记录定位到这个药物。总结一下：

- 如果患者按时服药，即小程序端启动时虽然计算出了很多漏掉的服药记录，但是马上接收到了药盒端传过来的服药记录，则消除所有漏掉的服药记录。
- 如果患者没有按时服药，则同理，监护人就能在小程序端看到患者的服药情况，提醒患者服药。
- 如果监护人在用药计划中更改某个药物的间隔、开始时间、结束时间等，会立刻生效，但是「已经结束的服药记录」完全不变，只会改变将来的那些服药计划。比如将来的某次服药时间 = 该药物最新的服药记录的时间 + 更改后的服药间隔。
- 如果监护人在用药计划中删除某个药物，可能会因为药物记录的id找不到而报错，这个也是待解决。
- 如果患者同一个药物有多次用药记录缺失，则理论上会弹出所有缺失的记录，让监护人选择是否服药。监护人此时不能因为看到这些缺失的记录就给患者喂药，不然一次性计量超标会出人命的，这个如何解决还没想好。


旺：每次到点提醒时，患者点击触摸屏上的按钮“打开药箱”，打开箱子取药，这个事件表示已经服药，自动记录到用药记录里；提醒超过一定时间还没打开药箱那就默认没吃药，也记录进去。每次服药时不需要询问是否已经用药。
尧：也不冲突，在「一定时间」内患者没有服用时，监护人打开小程序就能看到这个提醒，正好可以提醒患者服药。每种药物最多出现一个提醒，使用体验也会好一些。


